---
- set_fact: desktop_environment_process="xfce"
  when: ansible_limit == 'xfcevm'
  tags: resolution, tests

- set_fact: desktop_environment_process="gdm-x-session"
  when: ansible_limit == 'gnomevm'
  tags: resolution, tests

- set_fact: desktop_environment_process="kded5"
  when: ansible_limit == 'kdevm'
  tags: resolution, tests

- name: wait for desktop environment
  shell: "w | grep {{ desktop_environment_process }} | grep -v grep"
  register: desktop_session
  until: desktop_session.stdout != ""
  retries: 20
  delay: 2
  changed_when: false
  tags: resolution, tests

- name: set resolution
  shell: 'DISPLAY=":0" xrandr -s {{ screen_resolution }}'
  changed_when: false
  tags: resolution, tests

- name: create arrangeit user directory if it does not exist
  file:
    path: /home/vagrant/.local/share/arrangeit/
    state: directory
    mode: '0755'
  tags: tests

- name: copy user settings file
  copy:
    src: user_settings.json
    dest: /home/vagrant/.local/share/arrangeit/user_settings.json
    owner: vagrant
    group: vagrant
    mode: 0750
  tags: tests

- name: running all Robot Framework tests
  shell: 'DISPLAY=":0" {{ project_dir }}arrangeit/tests/functional/robotstart.sh test_start.robot'
  args:
    chdir: "{{ project_dir }}arrangeit/tests/functional"
  tags: tests
